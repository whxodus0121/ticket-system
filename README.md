# π« ν‹°μΌ“ μλ§¤ λ™μ‹μ„± μ μ–΄ ν”„λ΅μ νΈ (Ticket-System)

μ΄ ν”„λ΅μ νΈλ” λ™μ‹μ„± μ”μ²­μ΄ λ°μƒν•λ” ν‹°μΌ“ μλ§¤ μƒν™©μ—μ„ λ°μ΄ν„°μ μ •ν•©μ„±μ„ λ³΄μ¥ν•κ³ , 
μ‹μ¤ν… λ¶€ν•λ¥Ό μµμ†ν™”ν•λ” κ³Όμ •μ„ λ‹¨κ³„λ³„λ΅ ν•΄κ²°ν•΄ λ‚κ°€λ” λ°±μ—”λ“ μ‹μ¤ν…μ…λ‹λ‹¤.

## π“ λ²„μ „λ³„ κ°λ° κΈ°λ΅ (Tags)

### π”΄ v1.0: μΈν”„λΌ κµ¬μ¶• λ° κΈ°λ³Έ μ—°λ™
- **μ£Όμ” λ‚΄μ©**: Redis λ¶„μ‚° λ½ λ° MySQL μ—°λ™ μ™„λ£
- **ν•™μµ ν¬μΈνΈ**: Dockerλ¥Ό μ΄μ©ν• Redis, MySQL ν™κ²½ κµ¬μ¶• λ° Go μ–Έμ–΄μ™€μ κΈ°λ³Έμ μΈ μ»¤λ„¥μ… μ„¤μ •

### π΅ v2.0: λ™μ‹μ„± μ΄μ ν•΄κ²° (μ΄κ³Ό νλ§¤ λ°©μ§€)
- **μ£Όμ” λ‚΄μ©**: μ΄κ³Ό νλ§¤ λ°©μ§€, DB μ—°κ²° ν­μ£Ό μ—λ¬ ν•΄κ²°, μλ§¤ μ„±κ³µ λ…λ‹¨ κ΄€λ¦¬
- **ν•΄κ²° λ°©λ²•**: 
  - Redis λ¶„μ‚° λ½μ„ ν†µν• μ¬κ³  μ°¨κ°μ μ›μμ„± λ³΄μ¥
  - DB μ»¤λ„¥μ… ν’€ μµμ ν™”λ΅ `Too many connections` μ—λ¬ ν•΄κ²°
- **κ²°κ³Ό**: λ™μ‹μ— 1,000λ…μ΄ μ ‘μ†ν•΄λ„ μ„¤μ •λ μ¬κ³ λ§νΌλ§ μ •ν™•ν νλ§¤λ¨μ„ ν™•μΈ

### πΆ v3.0: λΉ„μ¦λ‹μ¤ μ •μ±… μ μ© (1μΈ 1λ§¤ μ ν•)
- **μ£Όμ” λ‚΄μ©**: 1μΈ 1λ§¤ μ¤‘λ³µ λ°©μ§€ λ΅μ§ μ¶”κ°€
- **ν•΄κ²° λ°©λ²•**: 
  - **Double-Checked Locking**: λ½ νλ“ μ „ν›„λ΅ κµ¬λ§¤ μ΄λ ¥μ„ ν™•μΈν•μ—¬ μ¤‘λ³µ μλ§¤λ¥Ό μ›μ² μ°¨λ‹¨
  - κ³ λ¶€ν• μƒν™©μ—μ„ λ°μƒν•λ” **Slow SQL** λ΅κ·Έ λ¶„μ„μ„ ν†µν•΄ μ„±λ¥ λ³‘λ© μ§€μ  νμ•…
- **κ²°κ³Ό**: λ™μΌ μ•„μ΄λ””λ΅ λ¬΄ν• μ”μ²­μ„ λ³΄λ‚΄λ„ μ¤μ§ 1κ±΄μ κµ¬λ§¤ λ°μ΄ν„°λ§ λ‚¨λ„λ΅ λ³΄μ¥

### π”µ v4.0: ν‹°μΌ“ μ·¨μ† λ΅μ§ κµ¬ν„ λ° μ‹μ¤ν… μ„±λ¥ ν•κ³„ λ„μ¶
- **μ£Όμ” λ‚΄μ©**: μλ§¤ μ·¨μ† κΈ°λ¥ κµ¬ν„ λ° Redis-DB κ°„ λ°μ΄ν„° μ •ν•©μ„± λ³΄μ¥
- **ν•΄κ²° λ°©λ²•**: 
  - μ·¨μ† ν”„λ΅μ„Έμ¤ μ„¤κ³„: MySQL κµ¬λ§¤ λ‚΄μ—­ μ‚­μ  β†’ Redis μ¬κ³  λ³µκµ¬(+1) β†’ Redis κµ¬λ§¤μ λ…λ‹¨ μ κ±°μ μμ°¨μ  νλ¦„ κµ¬ν„
  - λ°μ΄ν„° μ •ν•©μ„± κ²€μ¦: DBμ— μ‹¤μ  κµ¬λ§¤ λ‚΄μ—­μ΄ μλ” κ²½μ°μ—λ§ μ·¨μ†λ¥Ό μΉμΈν•μ—¬, λΉ„μ •μƒμ μΈ μ¬κ³  μ¦κ°€(Over-stocking)λ¥Ό μ›μ² μ°¨λ‹¨
  - β οΈ μ§λ©΄ν• λ¬Έμ  (Slow SQL μ¬λ°)
  - ν„μƒ: λ™μ‹ μλ§¤ ν…μ¤νΈ μ‹ MySQL INSERT κ³Όμ •μ—μ„ 0.5s μ΄μƒμ μ§€μ—°μ΄ λ°μƒν•λ” Slow SQL μ¬λ° ν™•μΈ
  - μ›μΈ λ¶„μ„: Redisμ μΈλ©”λ¨λ¦¬ μ²λ¦¬ μ†λ„μ™€ MySQLμ λ””μ¤ν¬ I/O μ²λ¦¬ μ†λ„ μ°¨μ΄λ΅ μΈν• λ™κΈ°μ‹ μ €μ¥μ λ³‘λ© ν„μƒ λ°μƒ
- **κ²°κ³Ό**: μλ§¤μ™€ μ·¨μ†μ μ „μ²΄ μ‚¬μ΄ν΄μ€ μ™„μ„±λμ—μΌλ‚, κ³ λ¶€ν• ν™κ²½μ—μ„μ μ•μ •μ μΈ μ“°κΈ° μ„±λ¥μ„ μ„ν•΄ λΉ„λ™κΈ° λ©”μ‹μ§€ ν(Kafka) λ„μ…μ ν•„μ”μ„±μ„ κΈ°μ μ μΌλ΅ λ„μ¶

π£ v4.5: Kafka λΉ„λ™κΈ° μ²λ¦¬ μ™„μ„± λ° λ¶„μ‚° ν™κ²½ λ©±λ“±μ„± λ³΄μ¥
- **μ£Όμ” λ‚΄μ©**: Kafka λ„μ…μ„ ν†µν• μ“°κΈ° μ§€μ—°(Write-Behind) ν¨ν„΄ κµ¬ν„ λ° λ©”μ‹μ§€ μ¤‘λ³µ μ²λ¦¬ μµμ ν™”
- **ν•΄κ²° λ°©λ²•**: 
  - λΉ„λ™κΈ° μ €μ¥ νμ΄ν”„λΌμΈ: API μ„λ²„λ” Kafka Producerλ΅μ„ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³  μ¦‰μ‹ μ‘λ‹µν•λ©°, λ³„λ„μ Consumer μ›μ»¤κ°€ MySQL μ €μ¥μ„ μ „λ‹΄ν•μ—¬ Slow SQL λ³‘λ© ν•΄κ²°
  - λ©±λ“±μ„±(Idempotency) μ„¤κ³„: Kafkaμ μ¬μ „μ†΅ μ •μ±…μΌλ΅ μΈν• μ¤‘λ³µ λ°μ΄ν„° μ μ… μ‹μ—λ„ DB λ¬΄κ²°μ„±μ„ μ μ§€ν•λ„λ΅ UNIQUE KEY κΈ°λ°μ λ°©μ–΄λ§‰ κµ¬μ¶•
  - DB μµμ ν™” (GORM Clauses): OnConflict(DoNothing) μ „λµμ„ μ‚¬μ©ν•μ—¬ μ¤‘λ³µ λ°μ΄ν„° λ°μƒ μ‹ λ¶ν•„μ”ν• μ—λ¬ λ΅κ·Έ λ€μ‹  'μ°μ•„ν• μ¤ν‚µ(Graceful Skip)' μ²λ¦¬
  - μΈν„°νμ΄μ¤ κ³ λ„ν™”: λ¦¬ν¬μ§€ν† λ¦¬ ν•¨μ λ¦¬ν„΄ νƒ€μ…μ„ (bool, error)λ΅ κ°μ„ ν•μ—¬ μ‹¤μ  μ €μ¥ μ„±κ³µ μ—¬λ¶€λ¥Ό μ›μ»¤κ°€ λ…ν™•ν μΈμ§€ν•λ„λ΅ κµ¬ν„
- **κ²°κ³Ό**: κ³ λ¶€ν• μƒν™©μ—μ„λ„ Redisμ μ²λ¦¬ μ†λ„μ™€ DB μ €μ¥ μ†λ„ κ°„μ κ°„κ·Ήμ„ Kafka λ²„νΌλ΅ μ™„λ²½ν ν•΄μ†ν•κ³ , λ°μ΄ν„° μ •ν•©μ„± 100% λ‹¬μ„±

---
## π›  Tech Stack
- **Language**: Go (Golang)
- **Database**: MySQL 8.0 (GORM)
- **Cache & Lock**: Redis
- **Message Broker**: Apache Kafka & Zookeeper
- **Container**: Docker, WSL2
- **Test**: Stress Testing with Goroutines

## π¦ μ‹¤ν–‰ λ°©λ²• (How to Run)
1. **μΈν”„λΌ μ»¨ν…μ΄λ„ μ‹¤ν–‰**
   Dockerλ¥Ό ν†µν•΄ ν•„μ λ―Έλ“¤μ›¨μ–΄(MySQL, Redis, Kafka, Zookeeper)λ¥Ό ν•κΊΌλ²μ— μ‹¤ν–‰ν•©λ‹λ‹¤.
   ```bash
   docker start ticket-mysql ticket-redis ticket-kafka ticket-zookeeper
   
2. **MySQL ν…μ΄λΈ” μƒμ„± λ° μ μ•½ μ΅°κ±΄ μ„¤μ •**

   μ¤‘λ³µ μλ§¤ λ°©μ§€(λ©±λ“±μ„±)λ¥Ό μ„ν•΄ UNIQUE KEYκ°€ ν¬ν•¨λ ν…μ΄λΈ”μ„ μƒμ„±ν•©λ‹λ‹¤.
   ```bash
   CREATE TABLE purchases (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    ticket_name VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_ticket (user_id, ticket_name)
   );
   
4. **Kafka Consumer μ›μ»¤ μ‹¤ν–‰**
   Kafka μ΄λ²¤νΈλ¥Ό κ°μ‹ν•λ©° DBμ— μ €μ¥ν•λ” μ›μ»¤λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤. (λ‹¤μ¤‘ ν„°λ―Έλ„ μ‹¤ν–‰ κ¶μ¥)
   ```bash
   go run cmd/worker/main.go
5. **API μ„λ²„ λ° λ™μ‹μ„± ν…μ¤νΈ μ‹¤ν–‰**
   μ‹¤μ  μλ§¤ μ”μ²­μ„ μƒμ„±ν•μ—¬ μ‹μ¤ν…μ„ ν…μ¤νΈν•©λ‹λ‹¤.
   ```bash
   go run main.go
